<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AYNA - Authentification</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="https://ayna.app/logo.png">
    <script defer src="https://cdn.vercel-insights.com/v1/script.js"></script>
</head>
<body>
    <div class="container">
        <div class="logo">✨</div>
        <h1>AYNA</h1>
        <p class="subtitle">Votre compagnon spirituel</p>
        <div class="links">
            <a href="verify-email.html" class="link-button">Vérification Email</a>
            <a href="reset-password.html" class="link-button">Réinitialisation Mot de Passe</a>
        </div>
    </div>

    <script>
        // Détecter les paramètres dans l'URL et rediriger automatiquement
        (function() {
            // Vérifier à la fois la query string et le hash
            const urlParams = new URLSearchParams(window.location.search);
            const hashParams = new URLSearchParams(window.location.hash.substring(1));
            
            // Supabase utilise access_token dans le hash pour les liens de réinitialisation
            const accessToken = hashParams.get('access_token') || urlParams.get('access_token');
            const token = urlParams.get('token') || urlParams.get('code') || hashParams.get('token') || hashParams.get('code');
            const tokenHash = urlParams.get('token_hash') || hashParams.get('token_hash');
            const type = urlParams.get('type') || hashParams.get('type');
            const typeHash = urlParams.get('type_hash') || hashParams.get('type_hash');
            
            // Si on a des paramètres de réinitialisation de mot de passe
            // Supabase envoie type=recovery dans le hash avec access_token
            if ((accessToken || token || tokenHash) && 
                (type === 'recovery' || typeHash === 'recovery' || 
                 window.location.hash.includes('type=recovery') ||
                 window.location.hash.includes('access_token'))) {
                // Rediriger vers reset-password.html en préservant TOUT le hash
                if (window.location.hash) {
                    window.location.href = `reset-password.html${window.location.hash}`;
                } else {
                    const params = new URLSearchParams();
                    if (token) params.set('token', token);
                    if (accessToken) params.set('access_token', accessToken);
                    if (tokenHash) params.set('token_hash', tokenHash);
                    if (type) params.set('type', type);
                    if (typeHash) params.set('type_hash', typeHash);
                    window.location.href = `reset-password.html?${params.toString()}`;
                }
                return;
            }

            // Si on a des paramètres de vérification d'email
            if (accessToken || token || tokenHash) {
                // Rediriger vers verify-email.html en préservant les paramètres
                if (window.location.hash) {
                    window.location.href = `verify-email.html${window.location.hash}`;
                } else {
                    const params = new URLSearchParams();
                    if (token) params.set('token', token);
                    if (accessToken) params.set('access_token', accessToken);
                    if (tokenHash) params.set('token_hash', tokenHash);
                    if (type) params.set('type', type);
                    if (typeHash) params.set('type_hash', typeHash);
                    window.location.href = `verify-email.html?${params.toString()}`;
                }
                return;
            }
        })();
    </script>
</body>
</html>

